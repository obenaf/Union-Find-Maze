<!DOCTYPE html>
<html>

<head>
   <meta charset="UTF-8">

   <style>
      .grid {
         margin: 1em auto;
         border-collapse: collapse
      }

      .grid td {
         cursor: pointer;
         width: 30px;
         height: 30px;
         border: 1px solid #ccc;
         text-align: center;
         font-family: sans-serif;
         font-size: 13px
      }

      .grid td.start {
         background-color: blue !important;
      }

      .grid td.clicked {
         border: none;
         background-color: black;
         font-weight: bold;
         color: white;
      }

      .grid td.unclicked {}

      .grid td.end {
         background-color: red;
      }
   </style>

   <script>
      //I honestly have no idea how this works
      //JavaScript, tis a silly place
      function clearGrid() {
         var x = document.getElementsByClassName("clicked");
         while (x) {
            x[0].className = "";
         }
      }

      function assimilate(classname) {
         var i = 0;
         var x = document.getElementsByClassName(classname);
         while (i < x.length) {
            x[0].className = "start";

            i++;
         }
      }


      var colorArray = ['#000000', '#0000FF'];
      var classArray = new Array(256);

      window.onload = function() {
         document.getElementById("refreshBtn").addEventListener('click', clearGrid);

         var grid = clickableGrid(16, 16, function(el, row, col, i) {

            if (classArray[((row + 1) * (col + 2))] == 1 || classArray[((row + 1) * (col))] == 1 || classArray[((row + 2) * (col + 1))] == 1 || classArray[((row) * (col + 1))] == 1) {
               assimilate(el.className);
               el.className = "start";
               for (var i = 1; i < 257; i++) {
                  if (classArray[i] == classArray[((row + 1) * (col + 1))]) {
                     classArray[i] = 1;
                  }
               }
               classArray[(row + 1) * (col + 1)] = 1;
            } else {

            }
         });

         document.body.appendChild(grid);


         function clickableGrid(rows, cols, callback) {
            for (var x = 1; x < 256; x++) {
               colorArray.push('#' + Math.floor(Math.random() * 16777215).toString(16));
            }
            for (x = 0; x < 128; x++) {

            }
            var classNum;
            var i = 1;
            var grid = document.createElement('table');
            grid.className = 'grid';
            for (var r = 0; r < rows; ++r) {
               var tr = grid.appendChild(document.createElement('tr'));
               for (var c = 0; c < cols; ++c) {
                  i++;
                  classNum = i;
                  var cell = tr.appendChild(document.createElement('td'));

                  if (r == 0 && c == 0) {
                     cell.className = "start";
                     classNum = 0;
                     classArray[0] = 1;
                  } else if (r == 15 && c == 15) {

                  }

                  if (typeof classArray[((c + 1) * (r + 1))] == 'undefined') {
                     classArray[((c + 1) * (r + 1))] = classNum;
                     cell.classList.add(classNum.toString(3));
                  } else {
                     classNum = classArray[((c + 1) * (r + 1))];
                     cell.classList.add(classNum.toString(3));
                  }
                  if (r != 15 && c != 15) {
                     var seed = Math.ceil(Math.random() * 3)
                     if (seed == 1) {
                        classArray[((c + 2) * (r + 1))] = classNum;
                     } else if (seed == 2) {
                        classArray[((c + 1) * (r + 2))] = classNum;
                     } else if (seed == 3) {

                     }
                  }
                  cell.style.backgroundColor = colorArray[classArray[((c + 1) * (r + 1))]];

                  cell.addEventListener('click', (function(el, r, c, i) {
                     return function() {
                        callback(el, r, c, i);
                     }
                  })(cell, r, c, i), false);
               }
            }
            return grid;
         }

      }
   </script>

</head>
<button id="refreshBtn" onclick="refreshEvent">Refresh</button>

</html>
